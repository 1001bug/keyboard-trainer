<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Keyboard Trainer</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;500;600&family=Space+Grotesk:wght@400;500;600&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-primary: #0a0a0f;
            --bg-secondary: #12121a;
            --bg-tertiary: #1a1a25;
            --text-primary: #ffffff;
            --text-secondary: #6b6b80;
            --text-muted: #3a3a4a;
            --accent-green: #22c55e;
            --accent-green-glow: rgba(34, 197, 94, 0.3);
            --accent-red: #ef4444;
            --accent-red-glow: rgba(239, 68, 68, 0.3);
            --accent-blue: #3b82f6;
            --accent-blue-glow: rgba(59, 130, 246, 0.2);
            --key-bg: #1e1e2a;
            --key-border: #2a2a3a;
            --key-shadow: rgba(0, 0, 0, 0.5);

            --pinky-lr: #a855f7;
            --ring-lr: #3b82f6;
            --middle-lr: #ef4444;
            --index-left: #14b8a6;
            --index-right: #f59e0b;

            --thumb-left: #607d8b;
            --thumb-right: #795548;


        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Space Grotesk', sans-serif;
            background: var(--bg-primary);
            color: var(--text-primary);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 40px 20px;
            background-image: 
                radial-gradient(ellipse at 50% 0%, rgba(59, 130, 246, 0.08) 0%, transparent 50%),
                radial-gradient(ellipse at 80% 50%, rgba(34, 197, 94, 0.05) 0%, transparent 40%);
        }

        h1 {
            font-size: 2rem;
            font-weight: 600;

            letter-spacing: -0.5px;
            background: linear-gradient(135deg, #fff 0%, #6b6b80 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
                margin-right: auto;
        }

        .main-container {
            display: flex;
            gap: 24px;
            margin-bottom: 40px;
            width: 100%;
            max-width: 900px;
            max-height: 300px;
            justify-content: space-between;
        }

        /* Exercise Display */
        .exercise-container {
            display: flex;
            flex-direction: column;
            flex-grow: 1;
            background: var(--bg-secondary);
            border-radius: 16px;
            padding: 16px;
            border: 1px solid var(--key-border);
            box-shadow: 0 4px 24px rgba(0, 0, 0, 0.3);
            /*min-height: 0;*/
        }

        .exercise-label {
            flex-shrink: 0;
            font-size: 0.75rem;
            text-transform: uppercase;
            letter-spacing: 1.5px;
            color: var(--text-secondary);
            margin-bottom: 16px;
        }

        .exercise-text {
            font-family: 'JetBrains Mono', monospace;
            font-size: 1.5rem;
            line-height: 1.6;
            letter-spacing: 0.15em;
            min-height: 60px;
            /*display: flex;*/
            flex-wrap: wrap;
            align-items: center;
            max-height: 250px;
            overflow-y: auto;
            scrollbar-color: var(--text-secondary) var(--text-muted);
            scrollbar-width: thin;
            mask-image: linear-gradient(to bottom, black 95%, transparent);

        }


        .exercise-text::-webkit-scrollbar {
        width: 12px;
        }

        .exercise-text::-webkit-scrollbar-track {
        background: var(--text-muted);
        }

        .exercise-text::-webkit-scrollbar-thumb {
        background: var(--text-secondary);
        border-radius: 6px;
        }

        .exercise-text::-webkit-scrollbar-thumb:hover {
        background: #888;
        }


        .exercise-text > span:has(+ br)::after {
            content: 'âŽ';
            color: var(--text-secondary);
            font-size: 0.5em;
            margin-left: 2px;
        }


        .word {
            display: inline-flex;
            white-space: nowrap;
            align-items: baseline;
        }

        .char {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            min-width: 1.2em;
            height: 1.5em;
            transition: all 0.15s ease;
        }

        .char.pending {
            color: var(--text-muted);
        }

        .char.completed {
            color: var(--text-primary);
        }

        .char.current {
            color: var(--bg-primary);
            background: var(--accent-green);
            border-radius: 6px;
            box-shadow: 0 0 20px var(--accent-green-glow);
            animation: pulse-green 1.5s ease-in-out infinite;
            scroll-margin-top: 45px;
        }

        .char.current.error {
            background: var(--accent-red);
            box-shadow: 0 0 20px var(--accent-red-glow);
            animation: shake 0.3s ease-in-out, pulse-red 1.5s ease-in-out infinite;
        }

        @keyframes pulse-green {
            0%, 100% { box-shadow: 0 0 15px var(--accent-green-glow); }
            50% { box-shadow: 0 0 25px var(--accent-green-glow); }
        }

        @keyframes pulse-red {
            0%, 100% { box-shadow: 0 0 15px var(--accent-red-glow); }
            50% { box-shadow: 0 0 25px var(--accent-red-glow); }
        }

        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            20% { transform: translateX(-4px); }
            40% { transform: translateX(4px); }
            60% { transform: translateX(-4px); }
            80% { transform: translateX(4px); }
        }

        /* Exercise List */
        .exercise-list-container {
            display:flex;
            flex-direction: column;
            flex-shrink: 0;
            width: 250px;
            background: var(--bg-secondary);
            border-radius: 16px;
            border: 1px solid var(--key-border);
            overflow: hidden;
            box-shadow: 0 4px 24px rgba(0, 0, 0, 0.3);
        }

        .exercise-list-header {
            flex-shrink: 0;
            font-size: 0.75rem;
            text-transform: uppercase;
            letter-spacing: 1.5px;
            color: var(--text-secondary);
            padding: 16px 20px;
            border-bottom: 1px solid var(--key-border);
        }
        .exercise-list-header > select
        {
            font-size: 0.75rem;
            text-transform: uppercase;
            letter-spacing: 1.5px;
            background: var(--bg-secondary);
            color: var(--text-secondary);
            width: 100%;
        }
        .exercise-list {
            max-height: 300px;
            overflow-y: auto;
            scrollbar-width: thin;
            scrollbar-color: var(--key-border) transparent;
        }

        .exercise-list::-webkit-scrollbar {
            width: 6px;
        }

        .exercise-list::-webkit-scrollbar-track {
            background: transparent;
        }

        .exercise-list::-webkit-scrollbar-thumb {
            background: var(--key-border);
            border-radius: 3px;
        }



        .exercise-group {
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.85rem;
            font-weight: bold;
            text-transform: uppercase;
            padding: 6px 10px;
            cursor: pointer;
            transition: all 0.2s ease;
            border-left: 3px solid transparent;
            color: var(--text-primary);
            border-bottom: 1px solid var(--text-secondary);
            border-top: 1px solid var(--text-secondary);
            background: var(--bg-primary);
        }
        .exercise-group.active {

            color: var(--accent-green);
        }

        .exercise-item {
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.85rem;
            padding: 6px 10px;
            cursor: pointer;
            transition: all 0.2s ease;
            border-left: 3px solid transparent;
            color: var(--text-secondary);
            /*border-bottom: 1px solid var(--text-secondary);*/
        }
        .exercise-item > span:first-child {
            text-transform: uppercase;
            /*letter-spacing: 1.5px;*/
            font-weight: bold;
        }
        .exercise-item > span:last-child {
            color: var(--text-secondary);
        }



        .exercise-item:hover {
            background: var(--bg-tertiary);
            color: var(--text-primary);
        }

        .exercise-item.active {
            background: var(--bg-tertiary);
            border-left-color: var(--accent-green);
            color: var(--text-primary);
        }

        .exercise-item.completed-exercise {
            color: var(--accent-green);
        }

        .exercise-item.completed-exercise::after {
            content: ' âœ“';
        }

        /* Stats Bar */
        .stats-bar {
            display: flex;
            gap: 32px;
            margin-bottom: 32px;
            padding: 16px 24px;
            background: var(--bg-secondary);
            border-radius: 12px;
            border: 1px solid var(--key-border);
                width: 100%;
            max-width: 900px;
        }

        .stat {
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .stat-value {
            font-family: 'JetBrains Mono', monospace;
            font-size: 1.5rem;
            font-weight: 600;
            color: var(--accent-blue);
        }

        .stat-label {
            font-size: 0.7rem;
            text-transform: uppercase;
            letter-spacing: 1px;
            color: var(--text-secondary);
            margin-top: 4px;
        }

        /* Keyboard */
        .keyboard {
            background: var(--bg-secondary);
            padding: 24px;
            border-radius: 20px;
            border: 1px solid var(--key-border);
            box-shadow: 
                0 8px 32px rgba(0, 0, 0, 0.4),
                inset 0 1px 0 rgba(255, 255, 255, 0.05);
        }

        .keyboard-row {
            display: flex;

            gap: 6px;
            margin-bottom: 6px;
        }


        .keyboard-row:last-child {
            margin-bottom: 0;
            justify-content: center;
        }

        .key {
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.9rem;
            font-weight: 500;
            width: 48px;
            height: 48px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: linear-gradient(180deg, var(--key-bg) 0%, #161620 100%);
            border: 1px solid var(--key-border);
            border-radius: 8px;
            color: var(--text-secondary);
            text-transform: uppercase;
            cursor: pointer;
            transition: all 0.1s ease;
            box-shadow: 
                0 4px 0 var(--key-shadow),
                0 4px 8px rgba(0, 0, 0, 0.3);
            user-select: none;
        }

        .key:active, .key.pressed {
            transform: translateY(4px);
            box-shadow: 
                0 2px 0 var(--key-shadow),
                0 2px 4px rgba(0, 0, 0, 0.3);
        }

        .key.highlight {
            color: var(--bg-primary);
            border-color: #cdcdcd;
        }


        .key.shift {
            width: 97px;
            font-size: 0.75rem;
        }
        .key.capslock {
            width: 70px;
            font-size: 0.75rem;
        }
        .key.tabkey {
            width: 55px;
            font-size: 0.75rem;
        }

        .key.space {
            width: 153px;
        }

        /* Home row indicators */
        .key[data-key="f"]::after,
        .key[data-key="j"]::after {
            content: '';
            position: absolute;
            bottom: 8px;
            width: 12px;
            height: 2px;
            background: var(--text-muted);
            border-radius: 1px;
        }

        .key {
            position: relative;
        }

        /* Finger color coding */
        .finger-pinky-left { border-color: var(--pinky-lr)}
        .finger-ring-left {  border-color: var(--ring-lr)}
        .finger-middle-left {  border-color: var(--middle-lr)} /* ! */
        .finger-index-left {   border-color: var(--index-left)} /* ! */

        .finger-index-right { border-color: var(--index-right)}
        .finger-middle-right {   border-color: var(--middle-lr)}
        .finger-ring-right {   border-color: var(--ring-lr)}
        .finger-pinky-right {   border-color: var(--pinky-lr)}

        .finger-thumb-left { border-color: var(--thumb-left)}
        .finger-thumb-right {   border-color: var(--thumb-right)}


        .key.highlight.finger-pinky-left { background: rgb(from var(--pinky-lr) r g b / 0.8); }
        .key.highlight.finger-ring-left { background: rgb(from var(--ring-lr) r g b / 0.8); }
        .key.highlight.finger-middle-left { background: rgb(from var(--middle-lr) r g b / 0.8); }

        .key.highlight.finger-index-left { background: rgb(from var(--index-left) r g b / 0.8);  }
        .key.highlight.finger-index-right { background: rgb(from var(--index-right) r g b / 0.8); }

        .key.highlight.finger-middle-right { background: rgb(from var(--middle-lr) r g b / 0.8);}
        .key.highlight.finger-ring-right { background: rgb(from var(--ring-lr) r g b / 0.8); }
        .key.highlight.finger-pinky-right { background: rgb(from var(--pinky-lr) r g b / 0.8); }

        .key.highlight.finger-thumb-left { background: rgb(from var(--thumb-left) r g b / 0.8); }
        .key.highlight.finger-thumb-right { background: rgb(from var(--thumb-right) r g b / 0.8); }

        /* Completion message */
        .completion-message {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%) scale(0.9);
            background: var(--bg-secondary);
            padding: 48px 64px;
            border-radius: 24px;
            border: 1px solid var(--accent-green);
            box-shadow: 0 0 60px var(--accent-green-glow);
            text-align: center;
            opacity: 0;
            pointer-events: none;
            transition: all 0.3s ease;
            z-index: 100;
        }

        .completion-message.show {
            opacity: 1;
            transform: translate(-50%, -50%) scale(1);
            pointer-events: auto;
        }

        .completion-message h2 {
            font-size: 1.5rem;
            margin-bottom: 8px;
            color: var(--accent-green);
        }

        .completion-message p {
            color: var(--text-secondary);
            margin-bottom: 24px;
        }

        .completion-message button {
            font-family: 'Space Grotesk', sans-serif;
            font-size: 1rem;
            padding: 12px 32px;

            color: var(--bg-primary);
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.2s ease;
            margin: 4px;
        }
        .completion-message button:last-of-type {
            background: var(--accent-green);
        }
        .completion-message button:first-of-type {
            background: var(--text-secondary);
        }

        .completion-message button:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 20px var(--accent-green-glow);
        }

        /* Focus hint */
        .focus-hint {
            color: var(--text-muted);
            font-size: 0.85rem;
            margin-top: 24px;
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .focus-hint.show {
            opacity: 1;
        }

        .github-badge {
            position: fixed;
            bottom: 8px;
            right: 8px;
         
        }
        .github-badge img {
        box-shadow: 0 0 5px 0px var(--text-secondary);
        }

        .toggle {
  position: relative;
  display: inline-block;
  width: 32px;
  height: 16px;
}

.toggle input {
  opacity: 0;
  width: 0;
  height: 0;
}
.slider {
  position: absolute;
  cursor: pointer;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background-color: #FFFFFF;
  -webkit-transition: .4s;
  transition: .4s;
}

.slider:before {
  position: absolute;
  content: "";
  height: 12px;
  width: 12px;
  left: 4px;
  bottom: 2px;
  background-color: var(--bg-tertiary);
  -webkit-transition: .4s;
  transition: .4s;
}

input:checked + .slider {
  background-color: var(--accent-blue);
}
input + .slider {
  background-color: var(--text-secondary);
}


input:checked + .slider:before {
  -webkit-transform: translateX(12px);
  -ms-transform: translateX(12px);
  transform: translateX(12px);
}

.slider.round {
  border-radius: 14px;
}

.slider.round:before {
  border-radius: 50%;
}
.toggle-box {
    display: flex;
    justify-content: flex-end;
    align-items: center;
    gap: 0.5rem;
    color: var(--text-secondary);
        margin-bottom: 8px;
        margin-right: 20px;
}

.collapsed {
    visibility: collapse;
    display: none;
}
    </style>
</head>
<body>


    <div class="stats-bar">
    <h1>Keyboard Trainer</h1>

        <div class="stat">
            <span class="stat-value" id="accuracy">100%</span>
            <span class="stat-label">Accuracy</span>
        </div>

        <div class="stat">
            <span class="stat-value" id="errors">0</span>
            <span class="stat-label">Errors</span>
        </div>

    </div>

    <div class="main-container">
        <div class="exercise-container">
            <div class="exercise-label">Type the following</div>
            <div class="exercise-text" id="exercise-text"></div>
        </div>
        <div class="exercise-list-container"> <!--Exercises -->
            <div class="exercise-list-header"> <select onchange="select_task_type(this)"><option value="0">basic exercises</option><option value="1">Advanced</option></select></div>
            <div class="exercise-list" id="exercise-list"></div>
        </div>
    </div>



    <div>
    <div class="toggle-box">
        <span>On-screen keyboard</span>
        <label class="toggle" >
            <input type="checkbox" checked onchange="document.getElementById('keyboard').classList.toggle('collapsed')">
            <span class="slider round"></span>
        </label>
    </div>

    <div class="keyboard" id="keyboard">
        <!-- Row 1: QWERTY -->
        <div class="keyboard-row">
            <div class="key tabkey" data-key="tabkey"> </div>
            <div class="key finger-pinky-left" data-key="q">Q</div>
            <div class="key finger-ring-left" data-key="w">W</div>
            <div class="key finger-middle-left" data-key="e">E</div>
            <div class="key finger-index-left" data-key="r">R</div>
            <div class="key finger-index-left" data-key="t">T</div>
            <div class="key finger-index-right" data-key="y">Y</div>
            <div class="key finger-index-right" data-key="u">U</div>
            <div class="key finger-middle-right" data-key="i">I</div>
            <div class="key finger-ring-right" data-key="o">O</div>
            <div class="key finger-pinky-right" data-key="p">P</div>

        </div>
        <!-- Row 2: ASDF -->
        <div class="keyboard-row">
            <div class="key capslock" data-key="capslock"> </div>
            <div class="key finger-pinky-left" data-key="a">A</div>
            <div class="key finger-ring-left" data-key="s">S</div>
            <div class="key finger-middle-left" data-key="d">D</div>
            <div class="key finger-index-left" data-key="f">F</div>
            <div class="key finger-index-left" data-key="g">G</div>
            <div class="key finger-index-right" data-key="h">H</div>
            <div class="key finger-index-right" data-key="j">J</div>
            <div class="key finger-middle-right" data-key="k">K</div>
            <div class="key finger-ring-right" data-key="l">L</div>
            <div class="key"> </div>
            <div class="key"> </div>
            <div class="key capslock"> </div>

        </div>
        <!-- Row 3: ZXCV -->
        <div class="keyboard-row">
            <div class="key shift finger-pinky-left" data-key="L_Shift">Shift</div>
            <div class="key finger-pinky-left" data-key="z">Z</div>
            <div class="key finger-ring-left" data-key="x">X</div>
            <div class="key finger-middle-left" data-key="c">C</div>
            <div class="key finger-index-left" data-key="v">V</div>
            <div class="key finger-index-left" data-key="b">B</div>
            <div class="key finger-index-right" data-key="n">N</div>
            <div class="key finger-index-right" data-key="m">M</div>
            <div class="key finger-middle-right" data-key=",">,</div>
            <div class="key finger-ring-right" data-key=".">.</div>
            <div class="key finger-pinky-right" data-key="?">?</div>
            <div class="key shift finger-pinky-right" data-key="R_Shift">Shift</div>
        </div>
        <!-- Row 4: Space -->
        <div class="keyboard-row">
            <div class="key space finger-thumb-left" style="justify-content: right;" data-key="L_Space">Spa&nbsp;</div>
            <div class="key space finger-thumb-right" style="justify-content: left;" data-key="R_Space">&nbsp;ce</div>
        </div>
    </div>
</div>
    <div class="focus-hint" id="focus-hint">Click anywhere or press any key to start</div>

    <div class="github-badge">
        <a href="https://github.com/1001bug/keyboard-trainer" target="_blank">
            <img src="https://img.shields.io/badge/GitHub-Repo-black?logo=github" alt="GitHub Badge">
        </a>
    </div>
    


    <div class="completion-message" id="completion-message">
        <h2>Exercise Complete!</h2>
        <p>Great job! Ready for the next one?</p>

        <button id="repeat-exercise-btn">Repeat Exercise</button>
        <button id="next-exercise-btn">Next Exercise</button>
    </div>

    <script>
"use strict";

        const leftHand = new Set(['q','w','e','r','t','a','s','d','f','g','z','x','c','v','b']);
        //const rightHand = new Set();


        // State
        let currentIndex = {e:0,t:-1,s:-1,toString: function(a = this.e,b = this.t,c=this.s) {return `${a}:${b}:${c}`;}};
        let currentSpanIndex = 0;
        let isError = false;
        let totalKeystrokes = 0;
        let errorCount = 0;
        let startTime = null;
        

        // DOM Elements
        const exerciseText = document.getElementById('exercise-text');
        const exerciseList = document.getElementById('exercise-list');
        const accuracyDisplay = document.getElementById('accuracy');
        //const wpmDisplay = document.getElementById('wpm');
        const errorsDisplay = document.getElementById('errors');
        const completionMessage = document.getElementById('completion-message');
        const nextExerciseBtn = document.getElementById('next-exercise-btn');
        const repeatExerciseBtn = document.getElementById('repeat-exercise-btn');
        const focusHint = document.getElementById('focus-hint');

        // Character span elements cache
        let charSpans = [];
        let taskStepsRef = [];

        //Basic vs advanced
        let exercises = [];

        //page init
        function onWindowLoad(){
            exercises.push(task_small);
            exercises.push(task_big);
            //console.log(exercises);

            initExerciseList();
            updateExerciseListDisplay();
        }//onWindowLoad

        function select_task_type(o){
            currentIndex.e = o.value;
            currentIndex.t = -1;
            currentIndex.s = -1;
            
            initExerciseList();
            updateExerciseListDisplay();
            createTaskStepDisplay();
        }


        // Initialize exercise list
        function initExerciseList() {
            exerciseList.innerHTML = '';
            taskStepsRef = [];



                exercises[currentIndex.e].forEach((task, t_idx) => {
                    const groupHeader = document.createElement('div');
                    groupHeader.className = 'exercise-group';
                    //if (t_idx === currentIndex.t) groupHeader.classList.add('active');
                    groupHeader.innerHTML = `${t_idx + 1}. ${task.dir}: ${task.name}`;
                    groupHeader.addEventListener('click', () => loadTaskStep(t_idx,0));
                    groupHeader.dataset.t_idx = t_idx;
                    exerciseList.appendChild(groupHeader);
                    taskStepsRef.push(groupHeader);

                    task.steps.forEach((step, s_idx) => {
                        //console.log('step ',step[0],' idx ',s_idx);
                        const item = document.createElement('div');
                        item.className = 'exercise-item';
                        item.dataset.t_idx = t_idx;
                        item.dataset.s_idx = s_idx;
                        item.dataset.ets_sign = currentIndex.toString(currentIndex.e,t_idx,s_idx);

                        item.innerHTML = `<span>${t_idx + 1}.${s_idx + 1}</span>&nbsp;<span>${step[0].substring(0, 14)}</span>`;
                        item.addEventListener('click', () => loadTaskStep(t_idx,s_idx));
                        exerciseList.appendChild(item);
                        taskStepsRef.push(item);
                    });
                    /*
                    */
                });

        }

        // Load an exercise
        function loadTaskStep(t,s) {
            currentIndex.t = t;
            currentIndex.s = s;

            currentSpanIndex = 0;
            isError = false;
            totalKeystrokes = 0;
            errorCount = 0;
            startTime = null;
            
            createTaskStepDisplay();
            updateTaskStepDisplay();
            updateExerciseListDisplay();
            updateStats();
            highlightCurrentKey();
            
        }



        // Create exercise display (once per exercise)
        function createTaskStepDisplay() {
            // Exercise -> Task -> Step

            exerciseText.scrollTop = 0;
            exerciseText.innerHTML = '';
            
            if (currentIndex.t < 0 || currentIndex.s < 0 ) return;
            
            charSpans = [];

            const rows = exercises[currentIndex.e][currentIndex.t].steps[currentIndex.s];

            rows.forEach((row, rowIndex) => {
                const words = row.split(' ');

                words.forEach((word, wordIndex) => {
                    // Create word container
                    const wordSpan = document.createElement('span');
                    wordSpan.className = 'word';

                    // Add characters of the word
                    word.split('').forEach((char) => {
                        const span = document.createElement('span');
                        span.className = 'char';
                        span.textContent = char;
                        //span.dataset.chr = char;

                        wordSpan.appendChild(span);
                        charSpans.push(span);
                    });


                    // Add space after word (except last word)
                    if (wordIndex < words.length - 1) {
                        const spaceSpan = document.createElement('span');
                        spaceSpan.className = 'char';
                        spaceSpan.textContent = 'â£';
                        //spaceSpan.dataset.chr = ' ';
                        wordSpan.appendChild(spaceSpan);
                        charSpans.push(spaceSpan);
                    }

                    exerciseText.appendChild(wordSpan);

                });
                if (rowIndex < rows.length - 1) {
                        const brakeSpan = document.createElement('br');
                        exerciseText.appendChild(brakeSpan);
                    }

            });


        }



        // Update exercise display (only update classes)
        function updateTaskStepDisplay() {
            charSpans.forEach((span, index) => {
                span.className = 'char';

                if (index < currentSpanIndex) {
                    span.classList.add('completed');
                } else if (index === currentSpanIndex) {
                    span.classList.add('current');
                    if (isError) span.classList.add('error');
                } else {
                    span.classList.add('pending');
                }
            });
            scrollToChar();
        }
        function updateExerciseListDisplay() {
            taskStepsRef.forEach((elem, index) => {
                elem.classList.remove('active');

                if (elem.dataset.s_idx !== undefined && elem.dataset.t_idx !== undefined && elem.dataset.ets_sign !== undefined) {
                    if(currentIndex.s == elem.dataset.s_idx && currentIndex.t == elem.dataset.t_idx){
                        elem.classList.add('active');
                    }
                    
                    const completed = localStorage.getItem('exercise_' + elem.dataset.ets_sign);
                    if (completed !== null) {
                        elem.classList.add('completed-exercise');
                    };

                }
                if (elem.dataset.s_idx === undefined && elem.dataset.t_idx !== undefined) {
                    if(currentIndex.t == elem.dataset.t_idx){
                        elem.classList.add('active');
                    }
                }

            });
            scrollToTaskStep();
        }

        // Highlight current key on keyboard
        function highlightCurrentKey() {
            // Remove all highlights
            document.querySelectorAll('.key').forEach(key => {
                key.classList.remove('highlight');
            });
            
            //const text = exercises[currentIndex];
            if (currentSpanIndex < charSpans.length) {
                const currentCharOrig = charSpans[currentSpanIndex].innerText;
                const currentChar = currentCharOrig.toLowerCase();

                if (currentChar !== 'â£') {
                    highlightKeys(currentChar);
                    if (currentCharOrig !== currentChar) {
                        if(leftHand.has(currentChar)){
                            highlightKeys('R_Shift') ;
                        } else {
                            highlightKeys('L_Shift');
                        }
                    }

                } else { //TODO: FIX NEGATIVE INDEX!!!!
                    let prevChar = charSpans[currentSpanIndex - 1].innerText;
                    if (prevChar !== undefined){
                        let lc = prevChar.toLowerCase();

                        if(leftHand.has(lc)){
                            highlightKeys('R_Space') ;
                        } else {
                            highlightKeys('L_Space');
                        }

                    }
                //console.log("currentChar: ",currentChar, "prev:", charSpans[currentSpanIndex - 1].innerText)
                }

            }
        }

        function highlightKeys(v) {
            const key = document.querySelector(`.key[data-key="${v}"]`);
            if (key) {
                key.classList.add('highlight');
            }
        }
        // Update statistics
        function updateStats() {
            const accuracy = totalKeystrokes > 0 
                ? Math.round(((totalKeystrokes - errorCount) / totalKeystrokes) * 100) 
                : 100;
            accuracyDisplay.textContent = accuracy + '%';
            errorsDisplay.textContent = errorCount;

        }

        // Handle key press
        function handleKeyPress(e) {
            // Ignore modifier keys alone
            if (e.key === 'Shift' || e.key === 'Control' || e.key === 'Alt' || e.key === 'Meta') {
                return;
            }
            
            // Handle Enter to go to next exercise when completion message is shown
            if ((e.key === 'Enter' || e.key === ' ') && completionMessage.classList.contains('show')) {
                goToNextExercise();
                return;
            }

            // Hide focus hint (Click anywhere or press any key to start)
            focusHint.classList.remove('show');
            



            //const text = exercises[currentIndex];
            if (currentSpanIndex >= charSpans.length) return;
            
            // Start timer on first keystroke
            if (!startTime) {
                startTime = Date.now();
            }
            
            const expectedChar = charSpans[currentSpanIndex].innerText;
            const pressedKey = e.key;
            
            totalKeystrokes++;
            
            // Visual feedback on keyboard
            const keyElement = document.querySelector(`.key[data-key="${pressedKey.toLowerCase()}"]`);
            if (keyElement) {
                keyElement.classList.add('pressed');
                setTimeout(() => keyElement.classList.remove('pressed'), 200);
            }
            
            if (pressedKey === expectedChar || (pressedKey === ' ' && expectedChar === 'â£')) {
                isError = false;
                currentSpanIndex++;

                
                if (currentSpanIndex >= charSpans.length) {
                    // Exercise complete. replace wiht 'localStorage'
                    //completedExercises.add(currentIndex.toString());
                    localStorage.setItem('exercise_' + currentIndex.toString(), 1);
                    
                    showCompletionMessage();
                }
                
                updateTaskStepDisplay();
                highlightCurrentKey();
                updateStats();
            } else {
                isError = true;
                errorCount++;
                updateTaskStepDisplay();
                updateStats();
            }
        }

        function scrollToChar() {

            //return;
            const container = exerciseText;
            const target = document.querySelector('.char.current');

            if (container === null || target === null) return;

            // Calculate the relative position
            const containerRect = container.getBoundingClientRect();
            const targetRect = target.getBoundingClientRect();

            // Calculate the scroll distance needed within the container
            // This example scrolls the top of the target to the top of the container's view
            const scrollTopDistance = targetRect.top - containerRect.top + container.scrollTop;

            // Set the new scroll position
            container.scrollTo({
                top: scrollTopDistance,
                behavior: 'smooth'
            });
            
            /*const element = document.querySelector('.char.current');
            if (element !== null) {
            element.scrollIntoView({
                behavior: 'smooth',
                block: 'start'
                });
            }*/
        }

        function scrollToTaskStep() {
            // Scroll to active item
            //container 'exerciseList'
            const activeItem = exerciseList.querySelector('.exercise-item.active');
            if (activeItem !== null) {
                activeItem.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
            }
        }




        // Show completion message
        function showCompletionMessage() {
            completionMessage.classList.add('show');
        }

        // Hide completion message and go to next exercise
        function goToNextExercise() {
            completionMessage.classList.remove('show');
            //current task: currentIndex.t
            //current step: currentIndex.s
            //number of tasks: exercises[currentIndex.e].length
            //number of steps: exercises[currentIndex.e][currentIndex.t].steps.length
            currentIndex.s += 1;
            if (currentIndex.s >= exercises[currentIndex.e][currentIndex.t].steps.length) {
                currentIndex.s = 0;

                currentIndex.t += 1;
                if(currentIndex.t >= exercises[currentIndex.e].length){
                    currentIndex.t = 0;
                    console.log('LAST TASK AND STEP IN CURRENT EXERCISE');
                }
            }

            loadTaskStep(currentIndex.t,currentIndex.s);
        }
        function goToSameExercise() {
            completionMessage.classList.remove('show');
            loadTaskStep(currentIndex.t,currentIndex.s);
        }

        // Event listeners
        document.addEventListener('keydown', handleKeyPress);
        
        nextExerciseBtn.addEventListener('click', goToNextExercise);
        repeatExerciseBtn.addEventListener('click', goToSameExercise);
        
        // Show focus hint initially
        setTimeout(() => focusHint.classList.add('show'), 500);
        
        document.addEventListener('click', () => {
            focusHint.classList.remove('show');
        });

        // Prevent space from scrolling
        window.addEventListener('keydown', (e) => {
            if (e.key === ' ') {
                e.preventDefault();
            }
        });

        // Initialize


console.log(`
%c
888    888 8888888888 888      888      .d88888b.       888       888  .d88888b.  8888888b.  888      8888888b.  
888    888 888        888      888     d88P" "Y88b      888   o   888 d88P" "Y88b 888   Y88b 888      888  "Y88b 
888    888 888        888      888     888     888      888  d8b  888 888     888 888    888 888      888    888 
8888888888 8888888    888      888     888     888      888 d888b 888 888     888 888   d88P 888      888    888 
888    888 888        888      888     888     888      888d88888b888 888     888 8888888P"  888      888    888 
888    888 888        888      888     888     888      88888P Y88888 888     888 888 T88b   888      888    888 
888    888 888        888      888     Y88b. .d88P      8888P   Y8888 Y88b. .d88P 888  T88b  888      888  .d88P 
888    888 8888888888 88888888 88888888 "Y88888P"       888P     Y888  "Y88888P"  888   T88b 88888888 8888888P"  
`, "color: #3b82f6; font-weight: bold;");

console.log(
  "%c ðŸš€ DIY Project %c System ready. Welcome to the backstage.",
  "background: #f59e0b; color: #3b82f6; padding: 5px 10px; border-radius: 4px 0 0 4px; font-weight: bold;",
  "background: #ef4444; color: white; padding: 5px 10px; border-radius: 0 4px 4px 0;"
);

        const task_big = [{"dir":"LR-RL","name":"L_I R_I","steps":[["th nt th nt th nt","ty ng ty ng ty ng","tu ur tu ur tu ur","ry ut ry ut ry ut","ru yt ru yt ru yt"],["rn yr rn yr rn yr","rm yb rm yb rm yb","gh ug gh ug gh ug","bu uf bu uf bu uf","tn ub tn ub tn ub"],["tm nv tm nv tm nv","rh nr rh nr rh nr","gy nf gy nf gy nf","gu nb gu nb gu nb","gn mb gn mb gn mb"],["gm ht gm ht gm ht","fy hr fy hr fy hr","fu fu fu fu fu fu","by by by by by by","bm bm bm bm bm bm","bj bj bj bj bj bj"]]},{"dir":"LR-RL","name":"L_M, R_M","steps":[["di ic di ic di ic","ci ie ci ie ci ie","ck ke ck ke ck ke","ek id ek id ek id","ei kd ei kd ei kd"]]},{"dir":"LR-RL","name":"L_R, L_P, R_R, R_P","steps":[["al la al la al la","so pa so pa so pa","sp ow sp ow sp ow","ap os ap os ap os","zo ls zo ls zo ls"],["xp ps xp ps xp ps","wo oz wo oz wo oz","wl ox wl ox wl ox","sl oa sl oa sl oa","ao ao ao ao ao ao"]]},{"dir":"LR-RL","name":"L_M, R_I","steps":[["en ne en ne en ne","ch me ch me ch me","em nd em nd em nd","cu he cu he cu he","ey nc ey nc ey nc"],["eu uc eu uc eu uc","eh ye eh ye eh ye","dy yd dy yd dy yd","du yc du yc du yc","dn ue dn ue dn ue"],["dm ud dm ud dm ud","dj je dj je dj je","cy cy cy cy cy cy"]]},{"dir":"LR-RL","name":"L_I, R_M","steps":[["ti it ti it ti it","ri iv ri iv ri iv","vi ir vi ir vi ir","fi ig fi ig fi ig"],["gi if gi if gi if","bi ib bi ib bi ib","rk rk rk rk rk rk"]]},{"dir":"LR-RL","name":"L_I, R_R, R_P","steps":[["ro or ro or ro or","to pr to pr to pr","fo ot fo ot fo ot","bo ov bo ov bo ov","bl pt bl pt bl pt"],["vo pg vo pg vo pg","tp og tp og tp og","tl of tl of tl of","rp ob rp ob rp ob","rl lv rl lv rl lv"],["go lt go lt go lt","gl lg gl lg gl lg","fl lf fl lf fl lf","lb lb lb lb lb lb"]]},{"dir":"LR-RL","name":"R_I, L_R, L_P","steps":[["an ns an ns an ns","su na su na su na","sh ma sh ma sh ma","am us am us am us","qu ha qu ha qu ha"],["ay ua ay ua ay ua","xu yw xu yw xu yw","xh ys xh ys xh ys","wn ya wn ya wn ya","wh uz wh uz wh uz"],["sy ms sy ms sy ms","sn ja sn ja sn ja","sm hs sm hs sm hs","au au au au au au","ah ah ah ah ah ah"]]},{"dir":"LR-RL","name":"L_I, R_M, R_R, R_P","steps":[["ti or ti or ti or","ri it ri it ri it","ro pr ro pr ro pr","to ot to ot to ot","vi iv vi iv vi iv"],["fi ov fi ov fi ov","gi ir gi ir gi ir","fo ig fo ig fo ig","bo if bo if bo if","bl pt bl pt bl pt"],["bi pg bi pg bi pg","vo og vo og vo og","tp of tp of tp of","tl ob tl ob tl ob","rp lv rp lv rp lv"],["rl lt rl lt rl lt","rk lg rk lg rk lg","go lf go lf go lf","gl lb gl lb gl lb","fl ib fl ib fl ib"]]},{"dir":"LR-RL","name":"R_I, L_M, L_R, L_P","steps":[["en ns en ns en ns","an ne an ne an ne","ch me ch me ch me","su nd su nd su nd","sh na sh na sh na"],["em ma em ma em ma","am he am he am he","qu us qu us qu us","cu nc cu nc cu nc","ay ha ay ha ay ha"],["xu uc xu uc xu uc","xh ua xh ua xh ua","wn yw wn yw wn yw","wh ys wh ys wh ys","sy ye sy ye sy ye"],["sn yd sn yd sn yd","sm yc sm yc sm yc","ey ya ey ya ey ya","eu uz eu uz eu uz","eh ue eh ue eh ue"],["dy ud dy ud dy ud","du ms du ms du ms","dn je dn je dn je","dm ja dm ja dm ja","dj hs dj hs dj hs"],["cy cy cy cy cy cy","au au au au au au","ah ah ah ah ah ah"]]},{"dir":"LL-RR","name":"L_I, R_I","steps":[["tr un tr un tr un","rt um rt um rt um","gr yn gr yn gr yn","br ym br ym br ym","tb uy tb uy tb uy"],["rv ny rv ny rv ny","rg nu rg nu rg nu","rf nm rf nm rf nm","rb nj rb nj rb nj","gt nh gt nh gt nh"],["ft my ft my ft my","fr mu fr mu fr mu","bt mn bt mn bt mn","ju ju ju ju ju ju","hy hy hy hy hy hy"],["hu hu hu hu hu hu","hn hn hn hn hn hn","hm hm hm hm hm hm"]]},{"dir":"LL-RR","name":"R_R, L_R, L_P, R_P","steps":[["as ol as ol as ol","wa lo wa lo wa lo","sa po sa po sa po","za pl za pl za pl"],["xa op xa op xa op","ws lp ws lp ws lp","sw sw sw sw sw sw","sq sq sq sq sq sq"],["az az az az az az","ax ax ax ax ax ax","aw aw aw aw aw aw","aq aq aq aq aq aq"]]},{"dir":"LL-RR","name":"L_M, R_I","steps":[["ed un ed un ed un","de um de um de um","ce yn ce yn ce yn","ec ym ec ym ec ym","dc uy dc uy dc uy"],["cd ny cd ny cd ny","nu nu nu nu nu nu","nm nm nm nm nm nm","nj nj nj nj nj nj","nh nh nh nh nh nh"],["my my my my my my","mu mu mu mu mu mu","mn mn mn mn mn mn","ju ju ju ju ju ju","hy hy hy hy hy hy"],["hu hu hu hu hu hu","hn hn hn hn hn hn","hm hm hm hm hm hm"]]},{"dir":"LL-RR","name":"L_I, R_M","steps":[["tr ki tr ki tr ki","rt ik rt ik rt ik","gr gr gr gr gr gr","br br br br br br","tb tb tb tb tb tb"],["rv rv rv rv rv rv","rg rg rg rg rg rg","rf rf rf rf rf rf","rb rb rb rb rb rb","gt gt gt gt gt gt"],["ft ft ft ft ft ft","fr fr fr fr fr fr","bt bt bt bt bt bt"]]},{"dir":"LL-RR","name":"L_I, R_R, R_P","steps":[["tr ol tr ol tr ol","rt lo rt lo rt lo","gr po gr po gr po","br pl br pl br pl","tb op tb op tb op"],["rv lp rv lp rv lp","rg rg rg rg rg rg","rf rf rf rf rf rf","rb rb rb rb rb rb","gt gt gt gt gt gt"],["ft ft ft ft ft ft","fr fr fr fr fr fr","bt bt bt bt bt bt"]]},{"dir":"LL-RR","name":"R_I, L_R, L_P","steps":[["as un as un as un","wa um wa um wa um","sa yn sa yn sa yn","za ym za ym za ym","xa uy xa uy xa uy"],["ws ny ws ny ws ny","sw nu sw nu sw nu","sq nm sq nm sq nm","az nj az nj az nj","ax nh ax nh ax nh"],["aw my aw my aw my","aq mu aq mu aq mu","mn mn mn mn mn mn","ju ju ju ju ju ju","hy hy hy hy hy hy"],["hu hu hu hu hu hu","hn hn hn hn hn hn","hm hm hm hm hm hm"]]},{"dir":"LL-RR","name":"L_I, R_M, R_R, R_P","steps":[["tr io tr io tr io","rt li rt li rt li","gr ol gr ol gr ol","br lo br lo br lo","tb po tb po tb po"],["rv il rv il rv il","rg pl rg pl rg pl","rf pi rf pi rf pi","rb op rb op rb op","gt ki gt ki gt ki"],["ft ip ft ip ft ip","fr ok fr ok fr ok","bt oi bt oi bt oi","lp lp lp lp lp lp","lk lk lk lk lk lk"],["ko ko ko ko ko ko","kl kl kl kl kl kl","ik ik ik ik ik ik"]]},{"dir":"LL-RR","name":"R_I, L_M, L_R, L_P","steps":[["es un es un es un","ed um ed um ed um","se yn se yn se yn","de ym de ym de ym","ea uy ea uy ea uy"],["ce ny ce ny ce ny","ca nu ca nu ca nu","ec nm ec nm ec nm","as nj as nj as nj","ac nh ac nh ac nh"],["ad my ad my ad my","we mu we mu we mu","wa mn wa mn wa mn","sc ju sc ju sc ju","sa hy sa hy sa hy"],["ex hu ex hu ex hu","ds hn ds hn ds hn","da hm da hm da hm","ze ze ze ze ze ze","za za za za za za"],["xe xe xe xe xe xe","xc xc xc xc xc xc","xa xa xa xa xa xa","ws ws ws ws ws ws","sw sw sw sw sw sw"],["sq sq sq sq sq sq","sd sd sd sd sd sd","ew ew ew ew ew ew","eq eq eq eq eq eq","dw dw dw dw dw dw"],["dc dc dc dc dc dc","cs cs cs cs cs cs","cd cd cd cd cd cd","az az az az az az","ax ax ax ax ax ax"],["aw aw aw aw aw aw","aq aq aq aq aq aq","ae ae ae ae ae ae"]]}];

        const task_small = [{"dir":"L-R","name":"Test","steps":[["f j f j f j","f j f j f j"],["g h g h g h","g h g h g h"]]},{"dir":"L-R","name":"Index","steps":[["f f f f f f f f f f","j j j j j j j j j j","g g g g g g g g g g","h h h h h h h h h h","fg fg fg fg fg fg"],["jh jh jh jh jh jh","fgjh fgjh fgjh fgjh","ghf jhg ghf jhg ghf","fghj jhgf fghj jhgf","g g h h f f j j"]]},{"dir":"L-R","name":"Middle","steps":[["d d d d d d d d d d","k k k k k k k k k k","df df df df df df","jk jk jk jk jk jk","dfg kjh dfg kjh"],["gfd hjk gfd hjk","dk dk dk dk dk dk","kdjf kdjf kdjf kdjf","dhg kfg dhg kfg","dd ff gg hh jj kk"]]},{"dir":"L-R","name":"Ring","steps":[["s s s s s s s s s s","l l l l l l l l l l","sd sd sd sd sd sd","kl kl kl kl kl kl","sdf jkl sdf jkl"],["asdf hjkl asdf hjkl","sl sl sl sl sl sl","sdfg hjkl sdfg hjkl","lsd ksf lsd ksf","ss dd ff gg hh jj kk ll"]]},{"dir":"L-R","name":"Pinky","steps":[["a a a a a a a a a a","as as as as as as","asdf hjkl asdf hjkl","aa ss dd ff gg hh jj kk ll"],["glas hask dash flash","sagas salad alaska","half ask lad gas jag"]]},{"dir":"L-R","name":"Upper row","steps":[["fr ju ft jy de ki","r r r t t t y y y u u u","rt yu rt yu rt yu","er ty ui er ty ui"],["try hit yet rut","tree here there","grey kite like","ture ryit uyer"]]},{"dir":"L-R","name":"Bottom row","steps":[["fv jm fb jn dc ki","v v v b b b n n n m m m","vb nm vb nm","cv bn m cv bn m"],["van man ban can","bad mad cad had","back hack jack lack"]]},{"dir":"L-R","name":"Word mix","steps":[["qo wp zx qo wp zx","qa az ws sx ed dc","pop wow zip axe","qwerty asdfgh zxcvb"],["power point zoom","mix max box fix","quick brown fox","lazy dog jumps"]]},{"dir":"L-R","name":"A hodgepodge","steps":[["f f f f f f f f","j j j j j j j j","f j f j f j f j","d d d d d d d d","k k k k k k k k"],["d k d k d k d k","s s s s s s s s","l l l l l l l l","s l s l s l s l","a a a a a a a a"],["f d s a f d s a","j k l j k l j k l","g g g g g g g g","h h h h h h h h","g h g h g h g h"],["f g h j f g h j","t t t t t t t t","y y y y y y y y","t y t y t y t y","r r r r r r r r"],["u u u u u u u u","r u r u r u r u","e e e e e e e e","i i i i i i i i","e i e i e i e i"],["w w w w w w w w","o o o o o o o o","w o w o w o w o","q q q q q q q q","p p p p p p p p","q p q p q p q p"],["the quick brown fox","jumps over the lazy dog","the quick brown fox","jumps over the lazy dog"]]}];
        window.onload = onWindowLoad;
    </script>
</body>
</html>





